<%- include("../partials/header") %>
<br>
<br>
<br>
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-sm-12" style="margin-top: 8px;">
            <div class="card <%= territory.kind %>">
                <div class="card-title text-center" id="name">
                                    <br>
                                    Karta terenu nr <%= territory.number %>
                </div>
                <div class="card-body">
                    <p class="info">Miejscowość: <strong><%= territory.city %></strong></p>
                        <p class="info">Ulica: 
                            <strong><%= territory.street %> 
                                <% if(typeof territory.beginNumber !== 'undefined'){ %>
                                    <%= territory.beginNumber %> 
                                                    <% if(typeof territory.endNumber !== 'undefined'){ %>
                                                        - <%= territory.endNumber %>
                                                    <% } %>
                                                <% } %>
                                            </strong>
                                        </p>
                                        <% if(typeof territory.description !== 'undefined' && territory.description !== ''){ %>
                                            <p class="info">Opis: <strong><%= territory.description %></strong></p>
                                        <% } %>
                                        
                                        <% if(typeof territory.forbidden !== 'undefined' && territory.forbidden !== ''){ %>
                                            <p class="info">Nie zachodzić: <strong><%= territory.forbidden %></strong></p>
                                        <% } %>
                                        <p class="info">Ostatnio opracowane: <strong><%= territory.lastWorked %></strong></p>
                                        
                                        <% if(typeof territory.preacher !== 'undefined'){ %>
                                            <p class="info">Głosiciel: <strong><%= territory.preacher.name %></strong></p>
                                            <p class="info">Pobrany: <strong><%= territory.taken %></strong></p>
                                            <p class="info"><strong><%= territory.preacher.name %> ma ten teren
                                                <% if(Math.round(Math.abs(new Date() - new Date(territory.taken)) / 86400000) < 90){ %>
                                                    <%= Math.round(Math.abs(new Date() - new Date(territory.taken)) / 86400000) %> dni
                                                <% } else if(Math.round(Math.abs(new Date() - new Date(territory.taken)) / 86400000) < 120){ %>
                                                    <span class="text-primary"><%= Math.round(Math.abs(new Date() - new Date(territory.taken)) / 86400000) %></span> dni
                                                <% } else if(Math.round(Math.abs(new Date() - new Date(territory.taken)) / 86400000) >= 120){ %>
                                                    <span class="text-danger"><%= Math.round(Math.abs(new Date() - new Date(territory.taken)) / 86400000) %></span> dni
                                                    <br>
                                                    <br>
                                                    <span class="text-danger"><strong>Przypomnij <%= territory.preacher.name %> o oddaniu terenu</strong> </span>
                                                <% } %>
                                            </strong></p>
                                        <% } else { %>
                                            <p class="info"><strong>Teren oznaczony jako <span class="text-success">wolny</span></strong> </p>
                                            <p class="info"><strong>Teren nie był opracowywany od 
                                                    <% if(Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) < 31){ %>
                                                        <%= Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) %> dni
                                                    <% } else if(Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) < 62){ %>
                                                        <span class="text-primary"><%= Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) %></span> dni
                                                    <% } else if(Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) < 93){ %>
                                                        <span class="text-orange" style="color: #fd7e14;"><%= Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) %></span> dni
                                                    <% } else if(Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) >= 124){ %>
                                                        <span class="text-danger"><%= Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) %></span> dni
                                                    <% } %>
                                            </strong></p>
                                        <% } %>
                                        <div class="d-inline">
                                                <a href="/territories/<%= territory._id %>/edit" class="btn btn-primary">Edytuj</a>
                                                <a href="/territories/<%= territory._id %>/delete" class="btn btn-danger">Usuń</a>
                                            </div>
                                        
                </div>
                <div class="card-footer">
                    <div class="row">
                        <h2 class="territory-section">Historia</h2>
                        <% territory.history.reverse().forEach((checkout) => { %>
                            <div class="col-lg-12">
                                <h3 id="name"><%= checkout.date.toLocaleDateString() %></h3>
                                <p class="info">Miejscowość: <strong><%= checkout.record.city %></strong></p>
                                <p class="info">Ulica: 
                                    <strong><%= checkout.record.street %> 
                                        <% if(typeof checkout.record.beginNumber !== 'undefined'){ %>
                                            <%= checkout.record.beginNumber %> 
                                                            <% if(typeof checkout.record.endNumber !== 'undefined'){ %>
                                                                - <%= checkout.record.endNumber %>
                                                            <% } %>
                                                        <% } %>
                                                    </strong>
                                                </p>
                                                <% if(typeof checkout.record.description !== 'undefined' && checkout.record.description !== ''){ %>
                                                    <p class="info">Opis: <strong><%= checkout.record.description %></strong></p>
                                                <% } %>
                                                
                                                <% if(typeof checkout.record.forbidden !== 'undefined' && checkout.record.forbidden !== ''){ %>
                                                    <p class="info">Nie zachodzić: <strong><%= checkout.record.forbidden %></strong></p>
                                                <% } %>
                                                <p class="info">Ostatnio opracowane: <strong><%= checkout.record.lastWorked %></strong></p>
                                                
                                                <% if(typeof checkout.record.preacher !== 'undefined'){ %>
                                                    <p class="info">Głosiciel: <strong><%= checkout.record.preacher.name %></strong></p>
                                                    <p class="info">Pobrany: <strong><%= checkout.record.taken %></strong></p>
                                                    <p class="info"><strong><%= checkout.record.preacher.name %> ma ten teren
                                                        <% if(Math.round(Math.abs(new Date() - new Date(checkout.record.taken)) / 86400000) < 90){ %>
                                                            <%= Math.round(Math.abs(new Date() - new Date(checkout.record.taken)) / 86400000) %> dni
                                                        <% } else if(Math.round(Math.abs(new Date() - new Date(checkout.record.taken)) / 86400000) < 120){ %>
                                                            <span class="text-primary"><%= Math.round(Math.abs(new Date() - new Date(checkout.record.taken)) / 86400000) %></span> dni
                                                        <% } else if(Math.round(Math.abs(new Date() - new Date(checkout.record.taken)) / 86400000) >= 120){ %>
                                                            <span class="text-danger"><%= Math.round(Math.abs(new Date() - new Date(checkout.record.taken)) / 86400000) %></span> dni
                                                            <br>
                                                            <br>
                                                            <span class="text-danger"><strong>Przypomnij <%= checkout.record.preacher.name %> o oddaniu terenu</strong> </span>
                                                        <% } %>
                                                    </strong></p>
                                                <% } else { %>
                                                    <p class="info"><strong>Teren oznaczony jako <span class="text-success">wolny</span></strong> </p>
                                                    <p class="info"><strong>Teren nie był opracowywany od 
                                                            <% if(Math.round(Math.abs(new Date() - new Date(checkout.record.lastWorked)) / 86400000) < 31){ %>
                                                                <%= Math.round(Math.abs(new Date() - new Date(checkout.record.lastWorked)) / 86400000) %> dni
                                                            <% } else if(Math.round(Math.abs(new Date() - new Date(checkout.record.lastWorked)) / 86400000) < 62){ %>
                                                                <span class="text-primary"><%= Math.round(Math.abs(new Date() - new Date(checkout.record.lastWorked)) / 86400000) %></span> dni
                                                            <% } else if(Math.round(Math.abs(new Date() - new Date(checkout.record.lastWorked)) / 86400000) < 93){ %>
                                                                <span class="text-orange" style="color: #fd7e14;"><%= Math.round(Math.abs(new Date() - new Date(territory.lastWorked)) / 86400000) %></span> dni
                                                            <% } else if(Math.round(Math.abs(new Date() - new Date(checkout.record.lastWorked)) / 86400000) >= 124){ %>
                                                                <span class="text-danger"><%= Math.round(Math.abs(new Date() - new Date(checkout.record.lastWorked)) / 86400000) %></span> dni
                                                            <% } %>
                                                    </strong></p>
                                                <% } %>
                                                <hr>
                            </div>
                        <% }) %>
                    </div>
                   
                </div>
            </div>
        </div>
    </div>
</div>      


<%- include("../partials/footer") %>